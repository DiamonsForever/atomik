<?xml version="1.0" encoding="UTF-8"?>
<chapter id="session" xmlns="http://docbook.org/ns/docbook">
	<title>Session</title>
	<sect1 id="session-starting-accessing">
		<title>Starting and accessing the session</title>
		<para>
			By default, Atomik will automatically starts the session. This can be turned off in the 
			<quote>atomik/start_session</quote> configuration key. 
		</para>
		<note>
			<methodname>Atomik::flash()</methodname> will not work if the session is not started.
		</note>
		<para>
			The session is available as the <quote>session</quote> key in the global store. Of course,
			it still remains available as the <varname>$_SESSION</varname> super-global variable.
		</para>
		<example>
			<title>Accessing the session from the global store</title>
			<programlisting>
				<![CDATA[
echo Atomik::get('session/username');]]>
			</programlisting>
		</example>
	</sect1>
	<sect1 id="session-flash">
		<title>Flash messages</title>
		<para>
			Flash messages are messages which are stored in the session and are available only once.
			This allows to pass error or success messages from one page to another. 
		</para>
		<para>
			To create a flash message call the <methodname>Atomik::flash()</methodname> method. It takes as
			first parameter a message or an array of messages. Messages can also have labels. For example <quote>error</quote> or 
			<quote>success</quote>. To specify a label, use the second argument. The default label is <quote>default</quote>.
		</para>
		<example>
			<title>Creating flash messages</title>
			<programlisting>
				<![CDATA[
Atomik::flash('The action has completed successfully');
Atomik::flash('The action has failed', 'error'); // with a label
Atomik::flash(array('message1', 'message2'), 'error');]]>
			</programlisting>
		</example>
		<para>
			Flash messages can then be retreived using the flash selector. The value is a label name. Use <quote>all</quote> to
			retreive all messages. It will return an array containing as key the label names and the associated
			value is an array of messages. If you only retreives messages from one label, an array of messages will be returned.
		</para>
		<example>
			<title>Retreiving flash messages</title>
			<programlisting>
				<![CDATA[
foreach (Atomik::get('flash:all) as $label => $messages) {
	foreach ($messages as $message) {
		// ...
	}
}

foreach (Atomik::get('flash:my_label) as $message) {
	// ...
}]]>
			</programlisting>
		</example>
	</sect1>
</chapter>
