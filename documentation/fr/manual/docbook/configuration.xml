<?xml version="1.0" encoding="UTF-8"?>
<!--
	Traduction par Triviak (triviak24@gmail.com)
	Non-définitive
-->
<chapter id="configuration" xmlns="http://docbook.org/ns/docbook">
	<title>Configuration</title>
	<note>
		Lors du changement de version d'Atomik entre 2.1 et 2.2, il y a eu une nette cassure de compatibilité.
		Beaucoup de clés ont été modifiées. Pour plus d'information, rendez-vous dans l'annexe A. La façon dont le fichier
		d'amorçage est inclue a aussi été changée. L'ancien fichier d'amorçage a maintenant été remplacé par un fichier de configuration.
	</note>
	<sect1 id="configuration-file">
		<title>Le fichier de configuration</title>
		<para>
			Atomik fournit un fichier de configuration par défaut pour tous (Atomik préférant le respect des conventions
			à la place du principe de configuration). Cependant, vous pouvez le réécrire et placer la configuration des plugins
			ou la votre à l'intérieur.
		</para>
		<para>
			Trois formats de fichiers sont désormais compatibles : PHP (par défaut), INI ou JSON.
			La format choisit dépent de l'extension de ce fichier (entre .php, .ini ou .json, en minuscule).
		</para>
		<para>
			Le fichier est par défaut placé dans le répertoire app et appelé <filename>config</filename>.
			Il peut être changé dans <quote>atomik/files/config</quote>. Attention : ne pas spécifier d'extension.
		</para>
		<para>
			Lorsque vous utilisez PHP, le script peut retourner un tableau qui pourra être utilisé avec la méthode <methodname>Atomik::set()</methodname>.
			Vous pouvez alors utiliser directement les accesseurs dans le fichier.
		</para>
		<para>
			Lorsque vous utilisez INI, vous pouvez utiliser des points dans la clé pour spécifier des clés multidimensionnelles. De plus, vous pouvez utiliser les slashs
			dans les clés JSON ou simplement utiliser les objets enfants.
		</para>
		<para>
			Les catégories des fichiers INI peuvent être traitées comme clés parentes et dimensionnées.
		</para>
		<para>
			Lorsque vous utilisez JSON, les données doivent être contenues dans un objet.
		</para>
		<example>
			<title>Configuration de type PHP(<filename>app/config.php</filename>)</title>
			<programlisting>
				<![CDATA[
return array(
    'ma_cle' => 'ma valeur',
    'plugins' => array(
        'Db' => array(
            'dsn' => 'mysql:host=localhost',
            'username' => 'root'
        )
    ),
    'atomik/files' => array(
        'pre_dispatch' = 'pre.php'
        'post_dispatch' = 'post.php'
    )
);]]>
			</programlisting>
		</example>
		<example>
			<title>Configuration de type INI(<filename>app/config.ini</filename>)</title>
			<programlisting>
				<![CDATA[
my_key = my value

[plugins]
Db.dsn = mysql:host=localhost
Db.username = root

[atomik.files]
pre_dispatch = pre.php
post_dispatch = post.php]]>
			</programlisting>
		</example>
		<example>
			<title>Configuration de type JSON (<filename>app/config.json</filename>)</title>
			<programlisting>
				<![CDATA[
{
	"ma_cle": "ma valeur",

	"plugins" : {
		"Db": {
			"dsn": "mysql:host=localhost",
			"username": "root"
		}
	},
	
	"atomik/files": {
		"pre_dispatch": "pre.php",
		"post_dispatch": "post.php"
	}
}]]>
			</programlisting>
		</example>
	</sect1>
	<sect1 id="bootstrapping">
		<title>L'amorçage</title>
		<para>
			Une fois la configuration chargée, Atomik va mettre en place son environnement et charger ses plugins. Puis,
			il essayera de charger le fichier d'amorçage. Il peut être utilisé pour préparer l'application, charger des bibliothèques
			additionnelles, ou encore des plugins.
		</para>
		<para>
			Le fichier doit impérativement être appelé avant <filename>bootstrap.php</filename> et placé dans le répertoire <filename>app</filename>.
			Dans ce fichier, on peut utiliser les accesseurs (la méthode <methodname>set()</methodname> bien entendu) pour définir
			les clés de configuration.
		</para>
		<para>
			Le nom de ce fichier peut être changé en utilisant la clé de configuration <quote>atomik/files/bootstrap</quote>.
		</para>
	</sect1>
	<sect1 id="custom-directory-structure">
		<title>Personnaliser la structure des dossiers</title>
		<para>
			Comme il a été dit dans le précédant chapitre concernant la procédure d'installation, la structure des dossiers peut être personnalisée.
			Cela peut être fait en modifiant les entrées dans la clé de configuration <quote>atomik/dirs</quote>
		</para>
		<figure>
			<title>La configuration par défaut des répertoires</title>
			<mediaobject>
				<imageobject role="html">
					<imagedata format="PNG" fileref="images/config_dirs.png" />
				</imageobject>
			</mediaobject>
		</figure>
		<para>
			Chaque clé dans le tableau de répertoire représente un type de répertoire. Cette valeur peut-être une chaîne de caractères pour
			un simple chemin ou un tableau dans le cas de multiples chemins.
		</para>
	</sect1>
	<sect1 id="pre-post-dispatch-file">
		<title>Avant et après l'envoie des fichiers</title>
		<para>
			Atomik vous autorise à créer deux fichiers : <filename>pre_dispatch.php</filename> et <filename>post_dispatch.php</filename>
			dans le répertoire  <filename>app</filename>. Ces fichiers seront appelés respectivement avant et après
			le processus d'expédition.
		</para>
		<para>
			Le nom de ces fichiers peut-être changés en utilisant les clés de configuration : <quote>atomik/files/pre_dispatch</quote>
			et <quote>atomik/files/post_dispatch</quote>
		</para>
	</sect1>
	<sect1 id="custom-error-page">
		<title>Personnaliser vos pages d'erreurs</title>
		<para>
			Lorsque qu'une erreur est soulevée, Atomik affichera alors un rapport d'erreur. Vous avez alors la possibilité de modifier cette page.
			Pour cela, créer un fichier <filename>error.php</filename> dans le répertoire <filename>app</filename>..
		</para>
		<para>
			Vous êtes alors libre d'y mettre se que vous voulez. Prenez garde car la disposition n'est pas appliquée sur cette page. Vous pouvez alors
			accéder aux variables appelées <quote>$exception</quote> qui contient toutes les exceptions rejetées.
		</para>
		<para>
			Il est tout aussi possible de personnaliser les erreurs 404. Pour cela, créez simplement un fichier <filename>404.php</filename> dans le 
			répertoire <filename>app</filename>. Comme la page d'erreur, le modèle ne sera pas appliqué.
		</para>
		<para>
			Les méta-données de ses fichiers peuvent être changées en utilisant les clés de configuration <quote>atomik/files/error</quote> et 
			<quote>atomik/files/404</quote>.
		</para>
	</sect1>
	<sect1 id="advanced-configuration">
		<title>Configuration avancée</title>
		<para>
			Il est parfois intéressant de créer des moutures qui possèdent leurs propres configurations. Par défaut, lorsque vous
			allez inclure la classe Atomik, elle sera automatiquement démarrée dans le processus d'expédition.  Ceci peut être désactiver
			en plaçant le paramètre <constant>ATOMIK_AUTORUN</constant> à false. Vous pouvez ensuite personnaliser votre fichier de configuration
			en utilisant les accesseurs et finalement lancer Atomik en utilisant <methodname>Atomik::run()</methodname>.
		</para>
		<example>
			<title>Création d'une distribution personnalisée.</title>
			<programlisting>
				<![CDATA[
<?php
define('ATOMIK_AUTORUN', false);
require 'Atomik.php';

// ma configuration
Atomik::set(array(
	// .. custom config
));

// lancons Atomik
Atomik::run();]]>
			</programlisting>
		</example>
	</sect1>
</chapter>