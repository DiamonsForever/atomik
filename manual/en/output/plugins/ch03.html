<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Chapter 3. Console</title>
    <link rel="stylesheet" href="../styles.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="start" href="index.html" title="Atomik Plugins Manual" />
    <link rel="up" href="index.html" title="Atomik Plugins Manual" />
    <link rel="prev" href="ch02.html" title="Chapter 2. Cache" />
    <link rel="next" href="ch04.html" title="Chapter 4. Controller" />
  </head>
  <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">Chapter 3. Console</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="ch02.html">Prev</a> </td>
          <th width="60%" align="center"> </th>
          <td width="20%" align="right"> <a accesskey="n" href="ch04.html">Next</a></td>
        </tr>
      </table>
      <hr />
    </div>
    <div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="console"></a>Chapter 3. Console</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ch03.html#console-scripts">Creating custom scripts</a></span></dt><dt><span class="sect1"><a href="ch03.html#console-commands">Using commands</a></span></dt><dt><span class="sect1"><a href="ch03.html#builtin-commands">Built-in commands</a></span></dt><dt><span class="sect1"><a href="ch03.html#console-utilities">Utility methods</a></span></dt></dl></div>
	
	<p>
		This plugins allow Atomik to be used in a terminal. It allows other plugins to provide
		custom commands and to create scripts to better administer your application.
	</p>
	<p>
		To call your application from the command line, use the following command
		</p><pre class="programlisting">
			php index.php [command] [args]
		</pre><p>
		Where <code class="filename">index.php</code> is Atomik's core file.
	</p>
	<div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="console-scripts"></a>Creating custom scripts</h2></div></div></div>
		
		<p>
			Scripts are simple php files. You can do anything you want with them. They are located
			in the <code class="filename">app/scripts</code> folder. This can be changed using the “<span class="quote">scripts_dir</span>”
			conguration key.
		</p>
		<p>
			To call your script use the previous command line by replacing [command] with the filename of your
			script without the extension.
		</p>
		<div class="example"><a id="id1152771"></a><p class="title"><b>Example 3.1. Calling custom scripts</b></p><div class="example-contents">
			
			<p>
				Let's create a script in <code class="filename">app/scripts/cleanup-my-db.php</code>
			</p>
			<pre class="programlisting">
				
&lt;?php
// do some stuff to cleanup my database
			</pre>
			<p>
				To call this script use the following command:
			</p>
			<pre class="programlisting">
				
php index.php cleanup-my-db
			</pre>
		</div></div><br class="example-break" />
		<p>
			It is possible for the script to access the command line arguments. A variable named <code class="varname">$arguments</code>
			is available in script files. It is an array containing all the arguments after the command name (like $_SERVER[argv]).
		</p>
		<div class="example"><a id="id1152806"></a><p class="title"><b>Example 3.2. Calling custom scripts with arguments</b></p><div class="example-contents">
			
			<p>
				Create a script in <code class="filename">app/scripts/cleanup-my-db.php</code>
			</p>
			<pre class="programlisting">
				
&lt;?php
echo 'cleaning ' . $arguments[0];
			</pre>
			<p>
				Call the following script using
			</p>
			<pre class="programlisting">
				
php index.php cleanup-my-db dbname
			</pre>
			<p>
				Will print “<span class="quote">cleaning dbname</span>”.
			</p>
		</div></div><br class="example-break" />
	</div>
	<div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="console-commands"></a>Using commands</h2></div></div></div>
		
		<p>
			A command is like a script but in the form of a function. Commands needs to be registered.
			Their useful because they provide a way for any plugins to add its own command for administration.
		</p>
		<p>
			To register a command use the <code class="methodname">ConsolePlugin::register()</code> method. It takes
			as first argument the command name (the one that will be used in the command line) and a php
			callback to the command's associated function or method.
		</p>
		<div class="example"><a id="id1152865"></a><p class="title"><b>Example 3.3. Creating a command</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
function myCommand()
{
	// ...
}
ConsolePlugin::register('my-command', 'myCommand');
			</pre>
			<p>
				Can be called with:
			</p>
			<pre class="programlisting">
				
php index.php my-command
			</pre>
		</div></div><br class="example-break" />
		<p>
			Like scripts, commands can retreive the arguments from the command line. They will be passed as the first
			parameter of the callback
		</p>
		<div class="example"><a id="id1152890"></a><p class="title"><b>Example 3.4. Creating a command with arguments</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
function sayHelloTo($arguments)
{
	echo 'hello ' . $arguments[0];
}
ConsolePlugin::register('say-hello-to', 'sayHelloTo');
			</pre>
			<p>
				Can be called with:
			</p>
			<pre class="programlisting">
				
php index.php say-hello-to peter
			</pre>
			<p>
				Will output “<span class="quote">hello peter</span>”.
			</p>
		</div></div><br class="example-break" />
		<p>
			Other plugins can listen for the Console::Start event and register their commands from the listener callback.
		</p>
	</div>
	<div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="builtin-commands"></a>Built-in commands</h2></div></div></div>
		
		<p>
			The plugin provides two built-in methods: <span class="command"><strong>init</strong></span> and <span class="command"><strong>generate</strong></span>.
		</p>
		<p>
			The first one will initialize a project by creating all the needed directories. If the “<span class="quote">--htaccess</span>”
			option is used, the <code class="filename">.htaccess</code> file will also be generated.
		</p>
		<div class="example"><a id="id1152956"></a><p class="title"><b>Example 3.5. Using the <span class="command">init</span> command</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
php index.php init [--htaccess]
			</pre>
		</div></div><br class="example-break" />
		<p>
			The second command allows you to create new actions and views. Just specify a name and the action file and the
			view file will be generated. You can generate multiple pages by separating them by a space
		</p>
		<div class="example"><a id="id1152976"></a><p class="title"><b>Example 3.6. Using the <span class="command">generate</span> command</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
php index.php generate home
php index.php generate photos about
			</pre>
		</div></div><br class="example-break" />
	</div>
	<div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="console-utilities"></a>Utility methods</h2></div></div></div>
		
		<p>
			The Console plugin also provides some utility methods.
		</p>
		<p>
			<code class="methodname">ConsolePlugin::println()</code> can be used to print a message on a single line.
			You can also control the indentation using the second argument (which is an int).
		</p>
		<p>
			<code class="methodname">ConsolePlugin::success()</code> and <code class="methodname">ConsolePlugin::fail()</code> are
			two methods to print a “<span class="quote">[SUCCESS]</span>” or “<span class="quote">[FAIL]</span>” string. A message can also be
			printed. They can work in conjonction with <code class="methodname">ConsolePlugin::println()</code>. A new line
			is added after a success or fail call.
		</p>
		<div class="example"><a id="id1153037"></a><p class="title"><b>Example 3.7. Printing a message</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
ConsolePlugin::println('trying to connect to the remote server...');
if ($connectionSuccess) {
	ConsolePlugin::success();
} else {
	ConsolePlugin::fail();
}
			</pre>
			<p>
				This will print something like (if success):
				“<span class="quote">trying to connect to the remote server... [SUCCESS]</span>”
			</p>
		</div></div><br class="example-break" />
		<p>
			You can create directories using <code class="methodname">ConsolePlugin::mkdir()</code>.
		</p>
		<div class="example"><a id="id1153064"></a><p class="title"><b>Example 3.8. Creating directories</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
ConsolePlugin::mkdir('/my/dir');
ConsolePlugin::mkdir('/my/dir', $indent, "My message to announce i'm creating a directory");
			</pre>
		</div></div><br class="example-break" />
		<p>
			Finally, you can create files using <code class="methodname">ConsolePlugin::touch()</code>.
		</p>
		<div class="example"><a id="id1153086"></a><p class="title"><b>Example 3.9. Creating files</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
ConsolePlugin::touch('/path/to/my/file.txt');
ConsolePlugin::touch('/path/to/my/file.txt', $fileContent);
ConsolePlugin::touch('/path/to/my/file.txt', '', $indent, "My message to announce i'm creating a file");
			</pre>
		</div></div><br class="example-break" />
	</div>
</div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="ch02.html">Prev</a> </td>
          <td width="20%" align="center"> </td>
          <td width="40%" align="right"> <a accesskey="n" href="ch04.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Chapter 2. Cache </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> Chapter 4. Controller</td>
        </tr>
      </table>
    </div>
  </body>
</html>
