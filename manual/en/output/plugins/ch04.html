<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Chapter 4. Controller</title>
    <link rel="stylesheet" href="../styles.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="start" href="index.html" title="Atomik Plugins Manual" />
    <link rel="up" href="index.html" title="Atomik Plugins Manual" />
    <link rel="prev" href="ch03.html" title="Chapter 3. Console" />
    <link rel="next" href="ch05.html" title="Chapter 5. Db" />
  </head>
  <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">Chapter 4. Controller</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="ch03.html">Prev</a> </td>
          <th width="60%" align="center"> </th>
          <td width="20%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td>
        </tr>
      </table>
      <hr />
    </div>
    <div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="controller"></a>Chapter 4. Controller</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ch04.html#controller-differences">Differences with the classic Atomik way</a></span></dt><dt><span class="sect1"><a href="ch04.html#creating-controllers">Creating controllers</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch04.html#controller-simple">Creating simple controllers</a></span></dt><dt><span class="sect2"><a href="ch04.html#controller-subclassing-atomik_controller">Creating controllers by subclassing <code class="classname">Atomik_Controller</code></a></span></dt></dl></dd></dl></div>
	
	<p>
		Atomik action files do not follow any conventions. However, some of you may have used MVC frameworks
		where the business logic is coded in controllers. Controllers are classes where their methods are
		actions.
	</p>
	<p>
		This plugin adds support for controllers to Atomik. Once activated you must use controllers in your
		actions. There is not possible mix between the classic way and the controller way.
	</p>
	<div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="controller-differences"></a>Differences with the classic Atomik way</h2></div></div></div>
		
		<p>
			There is two major differences which are views and the router.
		</p>
		<p>
			Each controller have multiple actions (methods) and each action has its own view. While having
			for example one file named <code class="filename">user.php</code> in the <code class="filename">actions</code> directory which
			contains the <code class="classname">UserController</code> class (will come to that later), you'll need many view
			files. Thus, instead of saving your views in the <code class="filename">views</code> directory you will have to save
			them in a folder named after your action.
		</p>
		<p>
			When using the router, the “<span class="quote">action</span>” parameter is mandatory. This plugin adds another mandatory
			parameter named “<span class="quote">controller</span>”. This parameter refers to the controller name whereas the “<span class="quote">action</span>”
			parameter refers to a method of the controller class.
		</p>
		<p>
			The default route is “<span class="quote">:controller/:action</span>”.
		</p>
		<div class="example"><a id="id1153171"></a><p class="title"><b>Example 4.1. Creating routes</b></p><div class="example-contents">
			
			<pre class="programlisting">
				
// ArchivesController::view()
Atomik::set('routes', array(
	'archives/:year/:month' =&gt; array(
		'controller' =&gt; 'archives',
		'action' =&gt; 'view'
	)
));
			</pre>
		</div></div><br class="example-break" />
		<p>
			The default controller name is “<span class="quote">index</span>” and the default action name is “<span class="quote">index</span>”.
		</p>
	</div>
	<div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="creating-controllers"></a>Creating controllers</h2></div></div></div>
		
		<div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="controller-simple"></a>Creating simple controllers</h3></div></div></div>
			
			<p>
				As said before, a controller is a class. The only condition is in the naming convention. Your class has to be named
				using the controller name starting by an upper case letter suffixed with “<span class="quote">Controller</span>”. So for example,
				with a controller named “<span class="quote">user</span>” (saved in <code class="filename">app/actions/user.php</code>), the class name
				will be <code class="classname">UserController</code>. 
			</p>
			<p>
				Then add public method to your class. All public method which does not start with am underscore will be callable as an
				action.
			</p>
			<p>
				Don't forget to also create the view associated to each action.
			</p>
			<div class="example"><a id="id1153245"></a><p class="title"><b>Example 4.2. Creating a simple controller</b></p><div class="example-contents">
				
				<pre class="programlisting">
					
class UserController
{
	public function index()
	{
	}
	
	public function login()
	{
	}
}
				</pre>
				<p>
					Also create two view files: <code class="filename">app/views/user/index.phtml</code> and <code class="filename">app/views/user/login.phtml</code>.
					Note that they are saved under the <code class="filename">app/views/user</code> directory where the last folder is the controller name.
				</p>
				<p>
					You can then use the following urls: http://example.com/user or http://example.com/user/login.
				</p>
			</div></div><br class="example-break" />
			<p>
				In classic actions, all defined variables where accessible from the view. This is not possible anymore when using methods for
				evident reasons. To forward method to the view, simply define class properties.
			</p>
			<div class="example"><a id="id1153292"></a><p class="title"><b>Example 4.3. Creating a simple controller with view variables</b></p><div class="example-contents">
				
				<pre class="programlisting">
					
class UserController
{
	public function index()
	{
		$this-&gt;username = 'peter';
	}
}
				</pre>
				<p>
					In your view (<code class="filename">app/views/user/index.phtml</code>):
				</p>
				<pre class="programlisting">
					
hello &lt;php echo $username ?&gt;
				</pre>
			</div></div><br class="example-break" />
		</div>
		<div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="controller-subclassing-atomik_controller"></a>Creating controllers by subclassing <code class="classname">Atomik_Controller</code></h3></div></div></div>
			
			<p>
				Subclassing Atomik_Controller when creating a controller class brings some nice features.
			</p>
			<p>
				First of all, you can define two methods <code class="methodname">_before()</code> and <code class="methodname">_after()</code>
				that will be called before and after each action.
			</p>
			<p>
				Secondly, route parameters will be automatically mapped to method arguments.
			</p>
			<div class="example"><a id="id1153348"></a><p class="title"><b>Example 4.4. Mapping route parameters to method arguments</b></p><div class="example-contents">
				
				<p>
					Let's define the following route:
				</p>
				<pre class="programlisting">
					
Atomik::set('routes', array(
	'archives/:year/:month' =&gt; array(
		'controller' =&gt; 'archives',
		'action' =&gt; 'view'
	)
));
				</pre>
				<p>
					And our controller:
				</p>
				<pre class="programlisting">
					
class ArchivesController
{
	public function view($year, $month)
	{
	}
}
				</pre>
				<p>
					The <code class="varname">$year</code> and <code class="varname">$month</code> argument will be taken from the route parameters.
				</p>
			</div></div><br class="example-break" />
			<p>
				Finally, it allows you to define routes parameters in the doc comment of your method. To do so, use the
				“<span class="quote">@route</span>” tag followed by the route definition.
			</p>
			<p>
				Route define this way will have “<span class="quote">:controller/:action/</span>” automatically prepended.
			</p>
			<p>
				When an argument is declared optional in the method, it will be declared optional in the route.
			</p>
			<div class="example"><a id="id1153400"></a><p class="title"><b>Example 4.5. Defining route parameters inside controllers</b></p><div class="example-contents">
				
				<pre class="programlisting">
					
class ArchivesController
{
	/**
	 * @route :year/:month
	 */
	public function view($year, $month)
	{
	}
}
				</pre>
				<p>
					This is the equivalent of the route defined in the previous example. 
				</p>
			</div></div><br class="example-break" />
		</div>
	</div>
</div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="ch03.html">Prev</a> </td>
          <td width="20%" align="center"> </td>
          <td width="40%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Chapter 3. Console </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> Chapter 5. Db</td>
        </tr>
      </table>
    </div>
  </body>
</html>
